<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamWeaver Dashboard (Ably)</title>
    <!-- Include Ably Client Library -->
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 500px; margin: 20px auto; }
        h1 { text-align: center; color: #333; }
        .controls { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 20px; }
        button {
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
            transition: background-color 0.3s ease;
            width: 200px; /* Fixed width for buttons */
        }
        #showButton { background-color: #4CAF50; /* Green */ }
        #showButton:hover { background-color: #45a049; }
        #hideButton { background-color: #f44336; /* Red */ }
        #hideButton:hover { background-color: #da190b; }
        #toggleButton { background-color: #008CBA; /* Blue */ }
        #toggleButton:hover { background-color: #007ba7; }
        #status { text-align: center; margin-top: 25px; padding: 10px; border-radius: 4px; font-style: italic; color: #555; background-color: #e9e9e9;}
    </style>
</head>
<body>
    <div class="container">
        <h1>StreamWeaver Control Dashboard (Ably)</h1>
        <div id="status">Initializing Ably...</div>
        <div class="controls">
            <button id="showButton">Show Overlay</button>
            <button id="hideButton">Hide Overlay</button>
            <button id="toggleButton">Toggle Overlay</button>
        </div>
    </div>

    <script>
        // dashboard.html inline script
        document.addEventListener('DOMContentLoaded', () => {
            const showButton = document.getElementById('showButton');
            const hideButton = document.getElementById('hideButton');
            const toggleButton = document.getElementById('toggleButton');
            const statusElement = document.getElementById('status');

            // --- PASTE YOUR ABLY API KEY HERE (APPROXIMATELY ROW 42) ---
            // --- Must be the SAME API Key as in script.js for index.html ---
            const ABLY_API_KEY = 'PpmbHg.J6_8kg:qC-BaNitrxujvNUg2DHRy8tlw3WECMYJispON6PCOik'; 
            const CHANNEL_NAME = 'streamweaver-control'; // Must be the same channel name

            if (ABLY_API_KEY === 'YOUR_ABLY_API_KEY_GOES_HERE' || !ABLY_API_KEY || ABLY_API_KEY.length < 10) {
                const errorMsg = "Ably API Key is missing or invalid in dashboard.html! Please update it.";
                alert(errorMsg);
                console.error(errorMsg);
                statusElement.textContent = "Ably API Key Missing!";
                return; // Stop further execution
            }

            console.log('Dashboard: Initializing Ably...');
            const ablyDashboard = new Ably.Realtime(ABLY_API_KEY);
            const dashboardChannel = ablyDashboard.channels.get(CHANNEL_NAME);

            ablyDashboard.connection.on('connected', () => {
                statusElement.textContent = 'Dashboard: Connected to Ably.';
                console.log('Dashboard: Successfully connected to Ably!');
            });
            ablyDashboard.connection.on('failed', (err) => {
                statusElement.textContent = 'Dashboard: Ably Connection Failed. Check console.';
                console.error('Dashboard: Ably connection failed:', err);
            });
            ablyDashboard.connection.on('disconnected', () => {
                statusElement.textContent = 'Dashboard: Ably Disconnected. Reconnecting...';
                console.warn('Dashboard: Ably disconnected. Will attempt to reconnect automatically.');
            });
            ablyDashboard.connection.on('suspended', () => {
                statusElement.textContent = 'Dashboard: Ably Suspended. Reconnecting...';
                console.warn('Dashboard: Ably suspended. Will attempt to reconnect automatically.');
            });


            function sendMessage(action) {
                if (!ablyDashboard || ablyDashboard.connection.state !== 'connected') {
                    statusElement.textContent = 'Dashboard: Not connected to Ably. Cannot send message.';
                    console.warn('Dashboard: Not connected to Ably. Cannot send message.');
                    return;
                }
                const messagePayload = { action: action };
                // Publish to the 'overlay-action' EVENT NAME on our CHANNEL
                dashboardChannel.publish('overlay-action', messagePayload, (err) => {
                    if (err) {
                        console.error(`Dashboard: Ably error publishing message for action '${action}':`, err);
                        statusElement.textContent = `Dashboard: Error sending '${action}'. Check console.`;
                    } else {
                        console.log(`Dashboard: Ably message published for action '${action}':`, messagePayload);
                        statusElement.textContent = `Dashboard: Sent '${action}' command via Ably.`;
                    }
                });
            }

            showButton.addEventListener('click', () => sendMessage('show'));
            hideButton.addEventListener('click', () => sendMessage('hide'));
            toggleButton.addEventListener('click', () => sendMessage('toggle'));
        });
    </script>
</body>
</html>
